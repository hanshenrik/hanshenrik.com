---
import { type CollectionEntry, getCollection, render } from "astro:content";
import { format } from "date-fns";
import { nb } from "date-fns/locale";
import Layout from "../../layouts/Layout.astro";
import { hasRequiredPostData } from "../../utils.ts";

export async function getStaticPaths() {
  const posts = await getCollection("drypp");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

const post = Astro.props as CollectionEntry<"drypp">;
const { Content } = await render(post);

if (!hasRequiredPostData(post.data)) {
  throw new Error(`Missing required fields for post ${post.id}`);
}

const { title, description, pubDate, updatedAt } = post.data;
---

<Layout title={title} showRssLink={true}>
  <article class="mx-auto max-w-3xl pt-16 pb-24">
    <header class="mb-8">
      <h1 class="mb-4">
        {title}
      </h1>
      <p class="mb-4">{description}</p>
      <div class="grid grid-cols-1">
        <time datetime={pubDate.toISOString()}>
          Publisert {format(pubDate, "dd.MM.yyyy", { locale: nb })}
        </time>
        {
          updatedAt && (
            <time datetime={updatedAt.toISOString()}>
              Oppdatert {format(updatedAt, "dd.MM.yyyy", { locale: nb })}
            </time>
          )
        }
      </div>
    </header>
    <div class="prose prose-a:no-underline">
      <Content />
    </div>
  </article>
</Layout>
